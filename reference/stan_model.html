<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Construct a Stan model — stan_model • rstan</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Construct a Stan model — stan_model"><meta property="og:description" content="Construct an instance of S4 class stanmodel from a model
  specified in Stan's modeling language. A stanmodel object
  can then be used to draw samples from the model. The Stan program
  (the model expressed in the Stan modeling language) is first translated to
  C++ code and then the C++ code for the model plus other auxiliary
  code is compiled into a dynamic shared object (DSO) and then loaded.
  The loaded DSO for the model can be executed to draw samples, allowing
  inference to be performed for the model and data."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">rstan</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">2.26.24</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../articles/index.html">Vignettes</a>
</li>
<li>
  <a href="../reference/index.html">Functions</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Other Packages
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="https://mc-stan.org/rstanarm">rstanarm</a>
    </li>
    <li>
      <a href="https://mc-stan.org/bayesplot" class="external-link">bayesplot</a>
    </li>
    <li>
      <a href="https://mc-stan.org/shinystan" class="external-link">shinystan</a>
    </li>
    <li>
      <a href="https://mc-stan.org/loo" class="external-link">loo</a>
    </li>
    <li>
      <a href="https://mc-stan.org/projpred" class="external-link">projpred</a>
    </li>
    <li>
      <a href="https://mc-stan.org/rstantools">rstantools</a>
    </li>
  </ul></li>
<li>
  <a href="https://mc-stan.org" class="external-link">Stan</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://twitter.com/mcmc_stan" class="external-link">
    <span class="fa fa-twitter"></span>
     
  </a>
</li>
<li>
  <a href="https://github.com/stan-dev/rstan" class="external-link">
    <span class="fa fa-github"></span>
     
  </a>
</li>
<li>
  <a href="https://discourse.mc-stan.org/" class="external-link">
    <span class="fa fa-users"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Construct a Stan model</h1>
    
    <div class="hidden name"><code>stan_model.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Construct an instance of S4 class <code>stanmodel</code> from a model
  specified in Stan's modeling language. A <code>stanmodel</code> object
  can then be used to draw samples from the model. The Stan program
  (the model expressed in the Stan modeling language) is first translated to
  C++ code and then the C++ code for the model plus other auxiliary
  code is compiled into a dynamic shared object (DSO) and then loaded.
  The loaded DSO for the model can be executed to draw samples, allowing
  inference to be performed for the model and data.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">stan_model</span><span class="op">(</span></span>
<span>    <span class="va">file</span>, model_name <span class="op">=</span> <span class="st">"anon_model"</span>,</span>
<span>    model_code <span class="op">=</span> <span class="st">""</span>, stanc_ret <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>    boost_lib <span class="op">=</span> <span class="cn">NULL</span>, eigen_lib <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>    save_dso <span class="op">=</span> <span class="cn">TRUE</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    auto_write <span class="op">=</span> <span class="fu"><a href="rstan_options.html">rstan_options</a></span><span class="op">(</span><span class="st">"auto_write"</span><span class="op">)</span>,</span>
<span>    obfuscate_model_name <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    allow_undefined <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Logic.html" class="external-link">isTRUE</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">getOption</a></span><span class="op">(</span><span class="st">"stanc.allow_undefined"</span>, <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    allow_optimizations <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Logic.html" class="external-link">isTRUE</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">getOption</a></span><span class="op">(</span><span class="st">"stanc.allow_optimizations"</span>, <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    standalone_functions <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Logic.html" class="external-link">isTRUE</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">getOption</a></span><span class="op">(</span><span class="st">"stanc.standalone_functions"</span>, <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    use_opencl <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Logic.html" class="external-link">isTRUE</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">getOption</a></span><span class="op">(</span><span class="st">"stanc.use_opencl"</span>, <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    warn_pedantic <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Logic.html" class="external-link">isTRUE</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">getOption</a></span><span class="op">(</span><span class="st">"stanc.warn_pedantic"</span>, <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    warn_uninitialized <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Logic.html" class="external-link">isTRUE</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">getOption</a></span><span class="op">(</span><span class="st">"stanc.warn_uninitialized"</span>, <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    includes <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>    isystem <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/missing.html" class="external-link">missing</a></span><span class="op">(</span><span class="va">file</span><span class="op">)</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/basename.html" class="external-link">dirname</a></span><span class="op">(</span><span class="va">file</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/getwd.html" class="external-link">getwd</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>file</dt>
<dd><p>A character string or a connection that <span style="R">R</span> supports
    specifying the Stan model specification in Stan's modeling language.</p></dd>


  <dt>model_name</dt>
<dd><p>A character string naming the model; defaults
    to <code>"anon_model"</code>. However, the model name will be derived from
    <code>file</code> or <code>model_code</code> (if <code>model_code</code> is the name of a
    character string object) if <code>model_name</code> is not specified.</p></dd>


  <dt>model_code</dt>
<dd><p>Either a character string containing the model
    specification or the name of a character string object in the workspace.
    This is an alternative to specifying the model via the <code>file</code>
    or <code>stanc_ret</code> arguments.</p></dd>

  <dt>stanc_ret</dt>
<dd><p>A named list returned from a previous call to
    the <code><a href="stanc.html">stanc</a></code> function. The list can be used to specify the model
    instead of using the <code>file</code> or <code>model_code</code> arguments.</p></dd>

  <dt>boost_lib</dt>
<dd><p>The path to a version of the Boost C++ library to
    use instead of the one in the <span class="pkg">BH</span> package.</p></dd>

  <dt>eigen_lib</dt>
<dd><p>The path to a version of the Eigen C++ library to
    use instead of the one in the <span class="pkg">RcppEigen</span> package.</p></dd>

  <dt>save_dso</dt>
<dd><p>Logical, defaulting to <code>TRUE</code>, indicating
    whether the  dynamic shared object (DSO) compiled from the C++ code for the
    model will be saved or not. If <code>TRUE</code>, we can draw samples from
    the same model in another <span style="R">R</span> session using the saved DSO (i.e.,
    without compiling the C++ code again).</p></dd>

  <dt>verbose</dt>
<dd><p>Logical, defaulting to <code>FALSE</code>, indicating whether
    to report additional intermediate output to the console,
    which might be helpful for debugging.</p></dd>

  <dt>auto_write</dt>
<dd><p>Logical, defaulting to the value of
    <code>rstan_options("auto_write")</code>, indicating whether to write the
    object to the hard disk using <code><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">saveRDS</a></code>. Although this argument
    is <code>FALSE</code> by default, we recommend calling
    <code>rstan_options("auto_write" = TRUE)</code> in order to avoid unnecessary
    recompilations. If <code>file</code> is supplied and its <code><a href="https://rdrr.io/r/base/basename.html" class="external-link">dirname</a></code>
    is writable, then the object will be written to that same directory,
    substituting a <code>.rds</code> extension for the <code>.stan</code> extension.
    Otherwise, the object will be written to the <code><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></code>.</p></dd>

  <dt>obfuscate_model_name</dt>
<dd><p>A logical scalar that is <code>TRUE</code> by default and
    passed to <code><a href="stanc.html">stanc</a></code>.</p></dd>

  <dt>allow_undefined</dt>
<dd><p>A logical scalar that is <code>FALSE</code> by default and
    passed to <code><a href="stanc.html">stanc</a></code>.</p></dd>

  <dt>allow_optimizations</dt>
<dd><p>A logical scalar that is <code>FALSE</code> by default and
    passed to <code><a href="stanc.html">stanc</a></code>.</p></dd>

  <dt>standalone_functions</dt>
<dd><p>A logical scalar that is <code>FALSE</code> by default and
    passed to <code><a href="stanc.html">stanc</a></code>.</p></dd>

  <dt>use_opencl</dt>
<dd><p>A logical scalar that is <code>FALSE</code> by default and
    passed to <code><a href="stanc.html">stanc</a></code>.</p></dd>

  <dt>warn_pedantic</dt>
<dd><p>A logical scalar that is <code>FALSE</code> by default and
    passed to <code><a href="stanc.html">stanc</a></code>.</p></dd>

  <dt>warn_uninitialized</dt>
<dd><p>A logical scalar that is <code>FALSE</code> by default and
    passed to <code><a href="stanc.html">stanc</a></code>.</p></dd>

  <dt>includes</dt>
<dd><p>If not <code>NULL</code> (the default), then a character vector of
    length one (possibly containing one or more <code>"\n"</code>) of the form
    <code>'#include "/full/path/to/my_header.hpp"'</code>, which will be inserted
    into the C++ code in the model's namespace and can be used to provide definitions
    of functions that are declared but not defined in <code>file</code> or
    <code>model_code</code> when <code>allow_undefined = TRUE</code></p></dd>

  <dt>isystem</dt>
<dd><p>A character vector naming a path to look for
    file paths in <code>file</code> that are to be included within the Stan program
    named by <code>file</code>. See the Details section below.</p></dd>

</dl></div>
    <div id="details">
    <h2>Details</h2>
    <p>If a previously compiled <code>stanmodel</code> exists on the hard drive, its validity
  is checked and then returned without recompiling. The most common form of
  invalidity seems to be Stan code that ends with a <code>}</code> rather than a blank
  line, which causes the hash checker to think that the current model is different
  than the one saved on the hard drive. To avoid reading previously
  compiled <code>stanmodel</code>s from the hard drive, supply the <code>stanc_ret</code>
  argument rather than the <code>file</code> or <code>model_code</code> arguments.</p>
<p>There are three ways to specify the model's code for <code>stan_model</code>:</p><ol><li><p>parameter <code>model_code</code>: a character string containing the
        Stan model specification,</p></li>
<li><p>parameter <code>file</code>: a file name (or a connection) from
       which to read the Stan model specification, or</p></li>
<li><p>parameter <code>stanc_ret</code>: a list returned by <code>stanc</code>
        to be reused.</p></li>
</ol></div>
    <div id="value">
    <h2>Value</h2>
    

<p>An instance of S4 class <code><a href="stanmodel-class.html">stanmodel</a></code> that can be
  passed to the <code><a href="stanmodel-method-sampling.html">sampling</a></code>, <code><a href="stanmodel-method-optimizing.html">optimizing</a></code>, and</p>
<p></p>
<p><code><a href="stanmodel-method-vb.html">vb</a></code> functions.</p>
    </div>
    <div id="references">
    <h2>References</h2>
    <p>The Stan Development Team
  <em>Stan Modeling Language User's Guide and Reference Manual</em>.
  <a href="https://mc-stan.org/" class="external-link">https://mc-stan.org/</a>.</p>
    </div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p><code><a href="stanmodel-class.html">stanmodel</a></code> for details on the class.</p>
<p><code><a href="stanmodel-method-sampling.html">sampling</a></code>, <code><a href="stanmodel-method-optimizing.html">optimizing</a></code>, and <code><a href="stanmodel-method-vb.html">vb</a></code>,
  which take a <code>stanmodel</code> object as input, for estimating the model
  parameters.</p>
<p>More details on Stan, including the full user's guide and reference
  manual, can be found at <a href="https://mc-stan.org/" class="external-link">https://mc-stan.org/</a>.</p></div>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span><span class="va">stancode</span> <span class="op">&lt;-</span> <span class="st">'data {real y_mean;} parameters {real y;} model {y ~ normal(y_mean,1);}'</span></span></span>
<span class="r-in"><span><span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu">stan_model</span><span class="op">(</span>model_code <span class="op">=</span> <span class="va">stancode</span>, verbose <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="stanmodel-method-sampling.html">sampling</a></span><span class="op">(</span><span class="va">mod</span>, data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>y_mean <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">fit2</span> <span class="op">&lt;-</span> <span class="fu"><a href="stanmodel-method-sampling.html">sampling</a></span><span class="op">(</span><span class="va">mod</span>, data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>y_mean <span class="op">=</span> <span class="fl">5</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Jiqiang Guo, Jonah Gabry, Ben Goodrich, Andrew Johnson, Sebastian Weber.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer></div>

  


  

  </body></html>

